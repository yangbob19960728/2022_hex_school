import{i as L,r,j as B,o as d,c as v,h as o,p as b,y as S,F as A,z as F,u as R,k as N,m as y,A as M,_ as T}from"./entry.df3d7c6d.js";const V={key:0},X={key:1},j=["src","data-time","onClick"],z=["onClick"];var I=(c=>(c[c.black=0]="black",c[c.blue=1]="blue",c[c.red=2]="red",c))(I||{});const U=L({__name:"signature",emits:["update"],setup(c,{emit:h}){const a=r(null);let u;r(null);const m=r(0),p=r(JSON.parse(localStorage.getItem("img"))||[]),s=r(0);B(()=>{u=a.value.getContext("2d"),u.lineWidth=4,u.lineCap="round",a.value.addEventListener("mousedown",w),a.value.addEventListener("touchstart",w)});function g(e){const t=a.value.getBoundingClientRect();return e instanceof MouseEvent?{x:e.clientX-t.left,y:e.clientY-t.top}:{x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top}}function w(e){e.preventDefault(),u.beginPath();const{x:t,y:n}=g(e);u.moveTo(t,n),e instanceof MouseEvent?(a.value.addEventListener("mouseup",l),a.value.addEventListener("mouseleave",l),a.value.addEventListener("mousemove",f)):(a.value.addEventListener("touchend",l),a.value.addEventListener("touchcancel",l),a.value.addEventListener("touchmove",f))}function f(e){const{x:t,y:n}=g(e);u.strokeStyle=I[m.value],u.lineTo(t,n),u.stroke()}function l(e){u.beginPath(),e instanceof MouseEvent?(a.value.removeEventListener("mouseup",l),a.value.removeEventListener("mouseleave",l),a.value.removeEventListener("mousemove",f)):(a.value.removeEventListener("touchend",l),a.value.removeEventListener("touchcancel",l),a.value.removeEventListener("touchmove",f))}function k(){u.clearRect(0,0,a.value.width,a.value.height)}function x(){const e=a.value.toDataURL("image/png");p.value.push({src:e,timestamp:Date.now()}),localStorage.setItem("img",JSON.stringify(p.value)),C(e)}function D(e){p.value.splice(e,1)}function C(e){h("update",e)}return(e,t)=>(d(),v("div",null,[o("div",null,[o("button",{onClick:t[0]||(t[0]=n=>s.value=0)}," \u624B\u5BEB\u7C3D\u540D "),o("button",{onClick:t[1]||(t[1]=n=>s.value=1)}," \u532F\u5165\u7C3D\u540D\u6A94 ")]),s.value==0?(d(),v("div",V,[o("canvas",{ref_key:"canvas",ref:a,width:"500",height:"300",style:{border:"1px solid #000"}},null,512),o("button",{onClick:x},"\u5132\u5B58"),o("button",{onClick:k},"\u6E05\u9664"),o("div",null,[o("button",{onClick:t[2]||(t[2]=n=>m.value=2)},"red"),o("button",{onClick:t[3]||(t[3]=n=>m.value=1)},"blue"),o("button",{onClick:t[4]||(t[4]=n=>m.value=0)},"black")])])):b("",!0),s.value==1?(d(),v("div",X,[S(" \u76EE\u524D\u7684\u7C3D\u540D "),(d(!0),v(A,null,F(p.value,(n,i)=>(d(),v("div",null,[o("img",{src:n.src,alt:"","data-time":n.timestamp,onClick:_=>C(n.src)},null,8,j),o("button",{onClick:_=>D(i)},"X",8,z)]))),256))])):b("",!0)]))}}),Y={class:"competition2"},J=o("label",{for:"fileInput"},"\u9078\u64C7\u6A94\u6848",-1),O=o("div",null," \u6216\u62D6\u79FB\u6A94\u6848\u5230\u6B64\u8655 ",-1),H=o("div",null," (\u965010MB \u5167\u7684PDF\u6216JPG\u6A94) ",-1),W={key:0},q={key:1,class:"sign"},Q=L({__name:"index",setup(c){const h=r(null),a=r(!1),{$fabric:u,$pdfjsLib:m,$jsPDF:p}=R();let s,g;N({title:"\u516D\u89D2\u6BD4\u8CFD\u7B2C\u4E8C\u5468"});const w=e=>new Promise((t,n)=>{const i=new FileReader;i.addEventListener("load",()=>t(i.result)),i.addEventListener("error",n),i.readAsArrayBuffer(e)}),f=async e=>{let t=await w(e);const n=await m.getDocument(t).promise,i=await n.getPage(n._pdfInfo.numPages),_=i.getViewport({scale:window.devicePixelRatio}),E=document.createElement("canvas"),$=E.getContext("2d");E.height=_.height,E.width=_.width;const P={canvasContext:$,viewport:_};return i.render(P).promise.then(()=>E)},l=async e=>{const t=1/window.devicePixelRatio;return new u.Image(e,{scaleX:t,scaleY:t})},k=r(!1);async function x(e){s.requestRenderAll(),g=e.target.files[0].name;const t=await f(e.target.files[0]),n=await l(t);s.setWidth(n.width/window.devicePixelRatio),s.setHeight(n.height/window.devicePixelRatio),s.setBackgroundImage(n,s.renderAll.bind(s)),a.value=!0}B(()=>{s=new u.Canvas(h.value)});function D(e){a.value=!1,u.Image.fromURL(e,function(t){t.top=400,t.scaleX=.5,t.scaleY=.5,s.add(t)}),k.value=!0}function C(){const e=new p,t=s.toDataURL({format:"png"}),n=e.internal.pageSize.width,i=e.internal.pageSize.height;e.addImage(t,"png",0,0,n,i),e.save(g)}return(e,t)=>{const n=U,i=T;return d(),v("div",Y,[o("div",null,[o("button",null,[J,o("input",{type:"file",accept:".pdf, .jpg",id:"fileInput",onChange:x},null,32)]),O,H]),o("div",null,[o("canvas",{style:{border:"1px solid #000"},ref_key:"canvas",ref:h,id:"canvas"},null,512)]),k.value?(d(),v("div",W,[o("button",{onClick:C},"\u4E0B\u8F09\u6A94\u6848")])):b("",!0),a.value?(d(),v("div",q,[y(i,null,{default:M(()=>[y(n,{onUpdate:D})]),_:1})])):b("",!0)])}}});export{Q as default};
